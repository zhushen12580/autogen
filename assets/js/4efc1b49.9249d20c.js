"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[7675],{58569:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>d});var t=a(85893),i=a(11151);const o={custom_edit_url:"https://github.com/microsoft/autogen/edit/main/notebook/agentchat_function_call_code_writing.ipynb",description:"Equip your agent with functions that can efficiently implement features into your software application.",source_notebook:"/notebook/agentchat_function_call_code_writing.ipynb",tags:["function call","code generation","tool use","software engineering"],title:"Writing a software application using function calls"},r="Writing a software application using function calls",s={id:"notebooks/agentchat_function_call_code_writing",title:"Writing a software application using function calls",description:"Equip your agent with functions that can efficiently implement features into your software application.",source:"@site/docs/notebooks/agentchat_function_call_code_writing.mdx",sourceDirName:"notebooks",slug:"/notebooks/agentchat_function_call_code_writing",permalink:"/autogen/docs/notebooks/agentchat_function_call_code_writing",draft:!1,unlisted:!1,editUrl:"https://github.com/microsoft/autogen/edit/main/notebook/agentchat_function_call_code_writing.ipynb",tags:[{label:"function call",permalink:"/autogen/docs/tags/function-call"},{label:"code generation",permalink:"/autogen/docs/tags/code-generation"},{label:"tool use",permalink:"/autogen/docs/tags/tool-use"},{label:"software engineering",permalink:"/autogen/docs/tags/software-engineering"}],version:"current",frontMatter:{custom_edit_url:"https://github.com/microsoft/autogen/edit/main/notebook/agentchat_function_call_code_writing.ipynb",description:"Equip your agent with functions that can efficiently implement features into your software application.",source_notebook:"/notebook/agentchat_function_call_code_writing.ipynb",tags:["function call","code generation","tool use","software engineering"],title:"Writing a software application using function calls"},sidebar:"notebooksSidebar",previous:{title:"Task Solving with Provided Tools as Functions (Asynchronous Function Calls)",permalink:"/autogen/docs/notebooks/agentchat_function_call_async"},next:{title:"Currency Calculator: Task Solving with Provided Tools as Functions",permalink:"/autogen/docs/notebooks/agentchat_function_call_currency_calculator"}},c={},d=[{value:"Requirements",id:"requirements",level:2},{value:"Set your API Endpoint",id:"set-your-api-endpoint",level:2},{value:"Create agents",id:"create-agents",level:2},{value:"Prepare appropriate functions",id:"prepare-appropriate-functions",level:2},{value:"Prepare code to work with",id:"prepare-code-to-work-with",level:2},{value:"Edit code using agents",id:"edit-code-using-agents",level:2},{value:"Result",id:"result",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",img:"img",p:"p",pre:"pre",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"writing-a-software-application-using-function-calls",children:"Writing a software application using function calls"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://colab.research.google.com/github/microsoft/autogen/blob/main/notebook/agentchat_function_call_code_writing.ipynb",children:(0,t.jsx)(n.img,{src:"https://colab.research.google.com/assets/colab-badge.svg",alt:"Open In Colab"})}),"\n",(0,t.jsx)(n.a,{href:"https://github.com/microsoft/autogen/blob/main/notebook/agentchat_function_call_code_writing.ipynb",children:(0,t.jsx)(n.img,{src:"https://img.shields.io/badge/Open%20on%20GitHub-grey?logo=github",alt:"Open on GitHub"})})]}),"\n",(0,t.jsx)(n.p,{children:"The default way of creating code in Autogen is its built-in code\nextractor. Although it allows for creating and executing simple scripts\nfast, that way of creating code is not suitable for developing advanced\nsoftware applications, according to my experiences. The process of\ndeveloping an application is mostly the process of introducing changes\ninto existing files rather than creating new files with code. And in my\nexperience, the code extractor is bad at introducing changes as the\nmodel often gets lost and can damage existing files."}),"\n",(0,t.jsx)(n.p,{children:"Properly created functions that can modify code provide us with the\nability to have more control over code changes and result in better\nquality. Additionally, as the scope of possible operations is predefined\ninside the tools, we can safely use Autogen without Docker, avoiding all\nthe complications related to it."}),"\n",(0,t.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"! pip install pyautogen\n"})}),"\n",(0,t.jsx)(n.h2,{id:"set-your-api-endpoint",children:"Set your API Endpoint"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'import os\n\nimport autogen\n\nconfig_list = [{"model": "gpt-4-turbo-preview", "api_key": os.getenv("OPENAI_API_KEY")}]\n'})}),"\n",(0,t.jsx)(n.h2,{id:"create-agents",children:"Create agents"}),"\n",(0,t.jsx)(n.p,{children:"In this example, we will improve a simple FastAPI application using only\ndedicated function calls. Let\u2019s create an Engineer agent that will think\nout and execute code changes, and a user proxy Admin agent, through\nwhich we will guide our Engineer."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'llm_config = {\n    "temperature": 0,\n    "config_list": config_list,\n}\n\nengineer = autogen.AssistantAgent(\n    name="Engineer",\n    llm_config=llm_config,\n    system_message="""\n    I\'m Engineer. I\'m expert in python programming. I\'m executing code tasks required by Admin.\n    """,\n)\n\nuser_proxy = autogen.UserProxyAgent(\n    name="Admin",\n    human_input_mode="ALWAYS",\n    code_execution_config=False,\n)\n'})}),"\n",(0,t.jsx)(n.p,{children:"Mention, unlike in many other examples, here we don\u2019t need a separate\nExecutor agent to save our code, as that will be done by functions. We\nalso don\u2019t need Docker to be running because of that - which makes the\nentire process easier."}),"\n",(0,t.jsx)(n.p,{children:"Next, let\u2019s set up our group chat."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'groupchat = autogen.GroupChat(\n    agents=[engineer, user_proxy],\n    messages=[],\n    max_round=500,\n    speaker_selection_method="round_robin",\n    enable_clear_history=True,\n)\nmanager = autogen.GroupChatManager(groupchat=groupchat, llm_config=llm_config)\n'})}),"\n",(0,t.jsx)(n.h2,{id:"prepare-appropriate-functions",children:"Prepare appropriate functions"}),"\n",(0,t.jsx)(n.p,{children:"Let\u2019s go to core of the thing. Prepare functions that provide Engineer\nwith functionality to modify existing code, create new code files, check\nfilesystem and files."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from typing_extensions import Annotated\n\ndefault_path = "backend_dir/"\n\n\n@user_proxy.register_for_execution()\n@engineer.register_for_llm(description="List files in choosen directory.")\ndef list_dir(directory: Annotated[str, "Directory to check."]):\n    files = os.listdir(default_path + directory)\n    return 0, files\n\n\n@user_proxy.register_for_execution()\n@engineer.register_for_llm(description="Check the contents of a chosen file.")\ndef see_file(filename: Annotated[str, "Name and path of file to check."]):\n    with open(default_path + filename, "r") as file:\n        lines = file.readlines()\n    formatted_lines = [f"{i+1}:{line}" for i, line in enumerate(lines)]\n    file_contents = "".join(formatted_lines)\n\n    return 0, file_contents\n\n\n@user_proxy.register_for_execution()\n@engineer.register_for_llm(description="Replace old piece of code with new one. Proper indentation is important.")\ndef modify_code(\n    filename: Annotated[str, "Name and path of file to change."],\n    start_line: Annotated[int, "Start line number to replace with new code."],\n    end_line: Annotated[int, "End line number to replace with new code."],\n    new_code: Annotated[str, "New piece of code to replace old code with. Remember about providing indents."],\n):\n    with open(default_path + filename, "r+") as file:\n        file_contents = file.readlines()\n        file_contents[start_line - 1 : end_line] = [new_code + "\\n"]\n        file.seek(0)\n        file.truncate()\n        file.write("".join(file_contents))\n    return 0, "Code modified"\n\n\n@user_proxy.register_for_execution()\n@engineer.register_for_llm(description="Create a new file with code.")\ndef create_file_with_code(\n    filename: Annotated[str, "Name and path of file to create."], code: Annotated[str, "Code to write in the file."]\n):\n    with open(default_path + filename, "w") as file:\n        file.write(code)\n    return 0, "File created successfully"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"prepare-code-to-work-with",children:"Prepare code to work with"}),"\n",(0,t.jsx)(n.p,{children:"In this example, we will show how AI can extend the functionalities of\nexisting code, as improving existing code is a much more frequent use\ncase in software development than creating a new one. Let\u2019s prepare the\ninitial code on which we will work. That will be a simple FastAPI script\nthat will allow you to calculate today\u2019s stock spread in percentage for\nCD Project Red, a famous Polish gamedev company. Create a folder called\n\u2018backend_dir\u2019 and place a \u2018main.py\u2019 file here with the following\ncontent:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'# backend_dir/main.py\n\nfrom fastapi import FastAPI\nimport yfinance as yf\n\napp = FastAPI()\n\n@app.get("/cdr_daily_spread")\nasync def calculate_daily_spread():\n    cdr = yf.Ticker("CDR.WA")\n    today_data = cdr.history(period="1d")\n    spread = ((today_data["High"] - today_data["Low"]) / today_data["Low"]) * 100\n    return spread\n'})}),"\n",(0,t.jsx)(n.p,{children:"Install needed libraries. We can run our API using:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"uvicorn main:app --reload\n"})}),"\n",(0,t.jsx)(n.p,{children:"Send a request to \u2018localhost:8000/cdr_daily_spread\u2019 to check if it\nworks."}),"\n",(0,t.jsx)(n.h2,{id:"edit-code-using-agents",children:"Edit code using agents"}),"\n",(0,t.jsx)(n.p,{children:"Let\u2019s assume we want our agents to extend the functionality of the\napplication. Let\u2019s modify the endpoint to check the spread also for\n11bits, another gamedev company, and compare it for both stocks. Also,\nlet\u2019s separate the internal logic into a different file."}),"\n",(0,t.jsx)(n.p,{children:"Finally, instantiate a chat between the Engineer and the Admin. It will\nstart by exploring the filesystem first, and after that, it will wait\nfor our orders. Then, we will explain the task to the Engineer and ask\nhim to provide a plan of changes first - according to my experience,\nthat greatly increases the quality of LLM responses."}),"\n",(0,t.jsx)(n.p,{children:"After that, introduce changes with the Engineer one after another. Ask\nhim to correct something or improve the functionality if needed. Do not\nhesitate to interrupt the tool\u2019s execution if you feel he is going to do\nsomething wrong. If errors occur, provide him with the error log and ask\nhim to check out the file to refresh his knowledge about it before\nactually introducing changes."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'chat_result = user_proxy.initiate_chat(\n    manager,\n    message="""\nYou will need to improve app in FastApi. For now, check out all the application files, try to understand it and wait for next instructions.\n""",\n)\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:'Admin (to chat_manager):\n\n\nYou will need to improve app in FastApi. For now, check out all the application files, try to understand it and wait for next instructions.\n\n\n--------------------------------------------------------------------------------\nEngineer (to chat_manager):\n\n***** Suggested tool Call (call_SA61u9yCLhyXfd9NCV9TAIiM): list_dir *****\nArguments: \n\n{\n  "directory": "./"\n}\n*************************************************************************\n\n--------------------------------------------------------------------------------\nProvide feedback to chat_manager. Press enter to skip and use auto-reply, or type \'exit\' to end the conversation:  \n\n>>>>>>>> NO HUMAN INPUT RECEIVED.\n\n>>>>>>>> USING AUTO REPLY...\n\n>>>>>>>> EXECUTING FUNCTION list_dir...\nAdmin (to chat_manager):\n\nAdmin (to chat_manager):\n\n***** Response from calling tool "call_SA61u9yCLhyXfd9NCV9TAIiM" *****\n[0, ["main.py", "__pycache__"]]\n**********************************************************************\n\n--------------------------------------------------------------------------------\nEngineer (to chat_manager):\n\n***** Suggested tool Call (call_IVJNPI12s4fCzysnWjExZjL2): see_file *****\nArguments: \n\n{\n  "filename": "main.py"\n}\n*************************************************************************\n\n--------------------------------------------------------------------------------\nProvide feedback to chat_manager. Press enter to skip and use auto-reply, or type \'exit\' to end the conversation:  \n\n>>>>>>>> NO HUMAN INPUT RECEIVED.\n\n>>>>>>>> USING AUTO REPLY...\n\n>>>>>>>> EXECUTING FUNCTION see_file...\nAdmin (to chat_manager):\n\nAdmin (to chat_manager):\n\n***** Response from calling tool "call_IVJNPI12s4fCzysnWjExZjL2" *****\n[0, "1:from fastapi import FastAPI\\n2:import yfinance as yf\\n3:\\n4:app = FastAPI()\\n5:\\n6:@app.get(\\"/cdr_daily_spread\\")\\n7:async def calculate_daily_spread():\\n8:    cdr = yf.Ticker(\\"CDR.WA\\")\\n9:    today_data = cdr.history(period=\\"1d\\")\\n10:    spread = ((today_data[\\"High\\"] - today_data[\\"Low\\"]) / today_data[\\"Low\\"]) * 100\\n11:    return spread"]\n**********************************************************************\n\n--------------------------------------------------------------------------------\nEngineer (to chat_manager):\n\nThe application is a FastAPI application with a single endpoint `/cdr_daily_spread`. This endpoint calculates the daily spread of the stock "CDR.WA" using the `yfinance` library. The spread is calculated as the percentage difference between the high and low prices of the stock for the day.\n\n--------------------------------------------------------------------------------\nProvide feedback to chat_manager. Press enter to skip and use auto-reply, or type \'exit\' to end the conversation:  Let\'s move spread calculation logic to separate file. Create spread_calculation function with ticker argument in it. in our endpoint, we need to compare daily spread for CD Project Red and 11bits Studio - return difference between them.  Start with providing plan of changes. Don\'t do any changes yet.\nAdmin (to chat_manager):\n\nLet\'s move spread calculation logic to separate file. Create spread_calculation function with ticker argument in it. in our endpoint, we need to compare daily spread for CD Project Red and 11bits Studio - return difference between them.  Start with providing plan of changes. Don\'t do any changes yet.\n\n--------------------------------------------------------------------------------\nEngineer (to chat_manager):\n\nSure, here is the plan of changes:\n\n1. Create a new Python file named `spread_calculation.py`.\n2. In this file, define a function named `calculate_daily_spread` that takes a `ticker` as an argument. This function will contain the logic to calculate the daily spread of a given stock.\n3. Modify the `main.py` file to import the `calculate_daily_spread` function from `spread_calculation.py`.\n4. Modify the `/cdr_daily_spread` endpoint in `main.py` to calculate the daily spread for both "CDR.WA" (CD Project Red) and "11B.WA" (11bits Studio) by calling the `calculate_daily_spread` function with the respective ticker as argument.\n5. The endpoint will then return the difference between the daily spreads of the two stocks.\n\nPlease confirm if this plan is correct and I can proceed with the changes.\n\n--------------------------------------------------------------------------------\nProvide feedback to chat_manager. Press enter to skip and use auto-reply, or type \'exit\' to end the conversation:  go with the plan\nAdmin (to chat_manager):\n\ngo with the plan\n\n--------------------------------------------------------------------------------\nEngineer (to chat_manager):\n\n***** Suggested tool Call (call_cqaVQJ6VQjR7lh114bxJGVfi): create_file_with_code *****\nArguments: \n\n{\n  "filename": "spread_calculation.py",\n  "code": "import yfinance as yf\\n\\ndef calculate_daily_spread(ticker):\\n    stock = yf.Ticker(ticker)\\n    today_data = stock.history(period=\\"1d\\")\\n    spread = ((today_data[\\"High\\"] - today_data[\\"Low\\"]) / today_data[\\"Low\\"]) * 100\\n    return spread"\n}\n**************************************************************************************\n\n--------------------------------------------------------------------------------\nProvide feedback to chat_manager. Press enter to skip and use auto-reply, or type \'exit\' to end the conversation:  \n\n>>>>>>>> NO HUMAN INPUT RECEIVED.\n\n>>>>>>>> USING AUTO REPLY...\n\n>>>>>>>> EXECUTING FUNCTION create_file_with_code...\nAdmin (to chat_manager):\n\nAdmin (to chat_manager):\n\n***** Response from calling tool "call_cqaVQJ6VQjR7lh114bxJGVfi" *****\n[0, "File created successfully"]\n**********************************************************************\n\n--------------------------------------------------------------------------------\nEngineer (to chat_manager):\n\n***** Suggested tool Call (call_qcoMK0RO5bXdY4yQz5RCh4mp): modify_code *****\nArguments: \n\n{\n  "filename": "main.py",\n  "start_line": 1,\n  "end_line": 11,\n  "new_code": "from fastapi import FastAPI\\nfrom spread_calculation import calculate_daily_spread\\n\\napp = FastAPI()\\n\\n@app.get(\\"/cdr_daily_spread\\")\\nasync def compare_daily_spread():\\n    cdr_spread = calculate_daily_spread(\\"CDR.WA\\")\\n    bits_spread = calculate_daily_spread(\\"11B.WA\\")\\n    return cdr_spread - bits_spread"\n}\n****************************************************************************\n\n--------------------------------------------------------------------------------\nProvide feedback to chat_manager. Press enter to skip and use auto-reply, or type \'exit\' to end the conversation:  Do not change whole the file. concentrate on the concrete lines.\nAdmin (to chat_manager):\n\nAdmin (to chat_manager):\n\n***** Response from calling tool "call_qcoMK0RO5bXdY4yQz5RCh4mp" *****\nUSER INTERRUPTED\n**********************************************************************\n\n--------------------------------------------------------------------------------\nDo not change whole the file. concentrate on the concrete lines.\n\n--------------------------------------------------------------------------------\nEngineer (to chat_manager):\n\n***** Suggested tool Call (call_hz1v2vEPPxKHeygjqs2lc8ii): modify_code *****\nArguments: \n\n{\n  "filename": "main.py",\n  "start_line": 1,\n  "end_line": 2,\n  "new_code": "from fastapi import FastAPI\\nfrom spread_calculation import calculate_daily_spread\\nimport yfinance as yf"\n}\n****************************************************************************\n\n--------------------------------------------------------------------------------\nProvide feedback to chat_manager. Press enter to skip and use auto-reply, or type \'exit\' to end the conversation:  \n\n>>>>>>>> NO HUMAN INPUT RECEIVED.\n\n>>>>>>>> USING AUTO REPLY...\n\n>>>>>>>> EXECUTING FUNCTION modify_code...\nAdmin (to chat_manager):\n\nAdmin (to chat_manager):\n\n***** Response from calling tool "call_hz1v2vEPPxKHeygjqs2lc8ii" *****\n[0, "Code modified"]\n**********************************************************************\n\n--------------------------------------------------------------------------------\nEngineer (to chat_manager):\n\n***** Suggested tool Call (call_1ABNdk6AATaVvn8UqLKBD5ZR): modify_code *****\nArguments: \n\n{\n  "filename": "main.py",\n  "start_line": 6,\n  "end_line": 11,\n  "new_code": "@app.get(\\"/cdr_daily_spread\\")\\nasync def compare_daily_spread():\\n    cdr_spread = calculate_daily_spread(\\"CDR.WA\\")\\n    bits_spread = calculate_daily_spread(\\"11B.WA\\")\\n    return cdr_spread - bits_spread"\n}\n****************************************************************************\n\n--------------------------------------------------------------------------------\nProvide feedback to chat_manager. Press enter to skip and use auto-reply, or type \'exit\' to end the conversation:  Check out file first to get actual lines position. Also, change endpoint name.\nAdmin (to chat_manager):\n\nAdmin (to chat_manager):\n\n***** Response from calling tool "call_1ABNdk6AATaVvn8UqLKBD5ZR" *****\nUSER INTERRUPTED\n**********************************************************************\n\n--------------------------------------------------------------------------------\nCheck out file first to get actual lines position. Also, change endpoint name.\n\n--------------------------------------------------------------------------------\nEngineer (to chat_manager):\n\n***** Suggested tool Call (call_2vlnu0RJ11qg6ygGT6l2tS3Q): see_file *****\nArguments: \n\n{\n  "filename": "main.py"\n}\n*************************************************************************\n\n--------------------------------------------------------------------------------\nProvide feedback to chat_manager. Press enter to skip and use auto-reply, or type \'exit\' to end the conversation:  \n\n>>>>>>>> NO HUMAN INPUT RECEIVED.\n\n>>>>>>>> USING AUTO REPLY...\n\n>>>>>>>> EXECUTING FUNCTION see_file...\nAdmin (to chat_manager):\n\nAdmin (to chat_manager):\n\n***** Response from calling tool "call_2vlnu0RJ11qg6ygGT6l2tS3Q" *****\n[0, "1:from fastapi import FastAPI\\n2:from spread_calculation import calculate_daily_spread\\n3:import yfinance as yf\\n4:\\n5:app = FastAPI()\\n6:\\n7:@app.get(\\"/cdr_daily_spread\\")\\n8:async def calculate_daily_spread():\\n9:    cdr = yf.Ticker(\\"CDR.WA\\")\\n10:    today_data = cdr.history(period=\\"1d\\")\\n11:    spread = ((today_data[\\"High\\"] - today_data[\\"Low\\"]) / today_data[\\"Low\\"]) * 100\\n12:    return spread"]\n**********************************************************************\n\n--------------------------------------------------------------------------------\nEngineer (to chat_manager):\n\n***** Suggested tool Call (call_gNwVSM2u33Ej89Yc2IkSAovu): modify_code *****\nArguments: \n\n{\n  "filename": "main.py",\n  "start_line": 7,\n  "end_line": 12,\n  "new_code": "@app.get(\\"/compare_daily_spread\\")\\nasync def compare_daily_spread():\\n    cdr_spread = calculate_daily_spread(\\"CDR.WA\\")\\n    bits_spread = calculate_daily_spread(\\"11B.WA\\")\\n    return cdr_spread - bits_spread"\n}\n****************************************************************************\n\n--------------------------------------------------------------------------------\nProvide feedback to chat_manager. Press enter to skip and use auto-reply, or type \'exit\' to end the conversation:  \n\n>>>>>>>> NO HUMAN INPUT RECEIVED.\n\n>>>>>>>> USING AUTO REPLY...\n\n>>>>>>>> EXECUTING FUNCTION modify_code...\nAdmin (to chat_manager):\n\nAdmin (to chat_manager):\n\n***** Response from calling tool "call_gNwVSM2u33Ej89Yc2IkSAovu" *****\n[0, "Code modified"]\n**********************************************************************\n\n--------------------------------------------------------------------------------\nEngineer (to chat_manager):\n\nThe changes have been made successfully. Now, the FastAPI application has an endpoint `/compare_daily_spread` which calculates and returns the difference between the daily spreads of "CDR.WA" (CD Project Red) and "11B.WA" (11bits Studio). The calculation logic is now in a separate file `spread_calculation.py`.\n\n--------------------------------------------------------------------------------\nProvide feedback to chat_manager. Press enter to skip and use auto-reply, or type \'exit\' to end the conversation:  Good. But add in return some addition description to be understandable which stock change is bigger. Remember to check out main.py first to actualize your knowledge.\nAdmin (to chat_manager):\n\nGood. But add in return some addition description to be understandable which stock change is bigger. Remember to check out main.py first to actualize your knowledge.\n\n--------------------------------------------------------------------------------\nEngineer (to chat_manager):\n\n***** Suggested tool Call (call_1Clo7beP49gWm1oXQXK7W6RH): see_file *****\nArguments: \n\n{\n  "filename": "main.py"\n}\n*************************************************************************\n\n--------------------------------------------------------------------------------\nProvide feedback to chat_manager. Press enter to skip and use auto-reply, or type \'exit\' to end the conversation:  \n\n>>>>>>>> NO HUMAN INPUT RECEIVED.\n\n>>>>>>>> USING AUTO REPLY...\n\n>>>>>>>> EXECUTING FUNCTION see_file...\nAdmin (to chat_manager):\n\nAdmin (to chat_manager):\n\n***** Response from calling tool "call_1Clo7beP49gWm1oXQXK7W6RH" *****\n[0, "1:from fastapi import FastAPI\\n2:from spread_calculation import calculate_daily_spread\\n3:import yfinance as yf\\n4:\\n5:app = FastAPI()\\n6:\\n7:@app.get(\\"/compare_daily_spread\\")\\n8:async def compare_daily_spread():\\n9:    cdr_spread = calculate_daily_spread(\\"CDR.WA\\")\\n10:    bits_spread = calculate_daily_spread(\\"11B.WA\\")\\n11:    return cdr_spread - bits_spread\\n"]\n**********************************************************************\n\n--------------------------------------------------------------------------------\nEngineer (to chat_manager):\n\n***** Suggested tool Call (call_Cl6jBUwvfa8JGbyldfrzYfiB): modify_code *****\nArguments: \n\n{\n  "filename": "main.py",\n  "start_line": 7,\n  "end_line": 11,\n  "new_code": "@app.get(\\"/compare_daily_spread\\")\\nasync def compare_daily_spread():\\n    cdr_spread = calculate_daily_spread(\\"CDR.WA\\")\\n    bits_spread = calculate_daily_spread(\\"11B.WA\\")\\n    spread_difference = cdr_spread - bits_spread\\n    if spread_difference > 0:\\n        return {\'message\': \'CD Project Red has a larger daily spread\', \'difference\': spread_difference}\\n    elif spread_difference < 0:\\n        return {\'message\': \'11bits Studio has a larger daily spread\', \'difference\': -spread_difference}\\n    else:\\n        return {\'message\': \'Both stocks have the same daily spread\', \'difference\': 0}"\n}\n****************************************************************************\n\n--------------------------------------------------------------------------------\nProvide feedback to chat_manager. Press enter to skip and use auto-reply, or type \'exit\' to end the conversation:  \n\n>>>>>>>> NO HUMAN INPUT RECEIVED.\n\n>>>>>>>> USING AUTO REPLY...\n\n>>>>>>>> EXECUTING FUNCTION modify_code...\nAdmin (to chat_manager):\n\nAdmin (to chat_manager):\n\n***** Response from calling tool "call_Cl6jBUwvfa8JGbyldfrzYfiB" *****\n[0, "Code modified"]\n**********************************************************************\n\n--------------------------------------------------------------------------------\nEngineer (to chat_manager):\n\nThe changes have been made successfully. Now, the `/compare_daily_spread` endpoint returns a dictionary with a message indicating which stock (CD Project Red or 11bits Studio) has a larger daily spread and the absolute difference between the daily spreads. If both stocks have the same daily spread, the message will indicate this and the difference will be 0.\n\n--------------------------------------------------------------------------------\nProvide feedback to chat_manager. Press enter to skip and use auto-reply, or type \'exit\' to end the conversation:  ValueError: The truth value of a Series is ambiguous.\nAdmin (to chat_manager):\n\nValueError: The truth value of a Series is ambiguous.\n\n--------------------------------------------------------------------------------\nEngineer (to chat_manager):\n\nThe error message indicates that the comparison operation is being performed on a pandas Series object, which is ambiguous. This is likely because the `calculate_daily_spread` function is returning a Series object instead of a single value.\n\nTo fix this, we need to ensure that the `calculate_daily_spread` function returns a single value. We can do this by taking the first (and only) value from the Series object. \n\nHere is the plan of changes:\n\n1. Modify the `calculate_daily_spread` function in `spread_calculation.py` to return only the first value from the `spread` Series.\n2. No changes are required in `main.py` as the returned value from `calculate_daily_spread` function will now be a single value.\n\nPlease confirm if this plan is correct and I can proceed with the changes.\n\n--------------------------------------------------------------------------------\nProvide feedback to chat_manager. Press enter to skip and use auto-reply, or type \'exit\' to end the conversation:  Cool. Remember to check out file before introducing modifications.\nAdmin (to chat_manager):\n\nCool. Remember to check out file before introducing modifications.\n\n--------------------------------------------------------------------------------\nEngineer (to chat_manager):\n\n***** Suggested tool Call (call_4wPhGFFW8pt8B28nVhVvWztN): see_file *****\nArguments: \n\n{\n  "filename": "spread_calculation.py"\n}\n*************************************************************************\n\n--------------------------------------------------------------------------------\nProvide feedback to chat_manager. Press enter to skip and use auto-reply, or type \'exit\' to end the conversation:  \n\n>>>>>>>> NO HUMAN INPUT RECEIVED.\n\n>>>>>>>> USING AUTO REPLY...\n\n>>>>>>>> EXECUTING FUNCTION see_file...\nAdmin (to chat_manager):\n\nAdmin (to chat_manager):\n\n***** Response from calling tool "call_4wPhGFFW8pt8B28nVhVvWztN" *****\n[0, "1:import yfinance as yf\\n2:\\n3:def calculate_daily_spread(ticker):\\n4:    stock = yf.Ticker(ticker)\\n5:    today_data = stock.history(period=\\"1d\\")\\n6:    spread = ((today_data[\\"High\\"] - today_data[\\"Low\\"]) / today_data[\\"Low\\"]) * 100\\n7:    return spread"]\n**********************************************************************\n\n--------------------------------------------------------------------------------\nEngineer (to chat_manager):\n\n***** Suggested tool Call (call_DL0p37GzppRSmoqFaOOLSNaI): modify_code *****\nArguments: \n\n{\n  "filename": "spread_calculation.py",\n  "start_line": 3,\n  "end_line": 7,\n  "new_code": "def calculate_daily_spread(ticker):\\n    stock = yf.Ticker(ticker)\\n    today_data = stock.history(period=\\"1d\\")\\n    spread = ((today_data[\\"High\\"] - today_data[\\"Low\\"]) / today_data[\\"Low\\"]) * 100\\n    return spread.values[0]"\n}\n****************************************************************************\n\n--------------------------------------------------------------------------------\nProvide feedback to chat_manager. Press enter to skip and use auto-reply, or type \'exit\' to end the conversation:  \n\n>>>>>>>> NO HUMAN INPUT RECEIVED.\n\n>>>>>>>> USING AUTO REPLY...\n\n>>>>>>>> EXECUTING FUNCTION modify_code...\nAdmin (to chat_manager):\n\nAdmin (to chat_manager):\n\n***** Response from calling tool "call_DL0p37GzppRSmoqFaOOLSNaI" *****\n[0, "Code modified"]\n**********************************************************************\n\n--------------------------------------------------------------------------------\nEngineer (to chat_manager):\n\nThe changes have been made successfully. Now, the `calculate_daily_spread` function in `spread_calculation.py` returns a single value instead of a pandas Series. This should resolve the ValueError you were encountering.\n\n--------------------------------------------------------------------------------\nProvide feedback to chat_manager. Press enter to skip and use auto-reply, or type \'exit\' to end the conversation:  exit\n'})}),"\n",(0,t.jsx)(n.h2,{id:"result",children:"Result"}),"\n",(0,t.jsx)(n.p,{children:"Finally, our agents modified a code so it looks like this:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"# backend_dir/main.py\n\nfrom fastapi import FastAPI\nfrom spread_calculation import calculate_daily_spread\nimport yfinance as yf\n\napp = FastAPI()\n\n@app.get(\"/compare_daily_spread\")\nasync def compare_daily_spread():\n    cdr_spread = calculate_daily_spread(\"CDR.WA\")\n    bits_spread = calculate_daily_spread(\"11B.WA\")\n    spread_difference = cdr_spread - bits_spread\n    if spread_difference > 0:\n        return {'message': 'CD Project Red has a larger daily spread', 'difference': spread_difference}\n    elif spread_difference < 0:\n        return {'message': '11bits Studio has a larger daily spread', 'difference': -spread_difference}\n    else:\n        return {'message': 'Both stocks have the same daily spread', 'difference': 0}\n\n\n# backend_dir/spread_calculation.py\n\nimport yfinance as yf\n\ndef calculate_daily_spread(ticker):\n    stock = yf.Ticker(ticker)\n    today_data = stock.history(period=\"1d\")\n    spread = ((today_data[\"High\"] - today_data[\"Low\"]) / today_data[\"Low\"]) * 100\n    return spread.values[0]\n"})}),"\n",(0,t.jsx)(n.p,{children:"You can check out work of application with Postman or curl and see the\nnext output:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n    "message": "11bits Studio has a larger daily spread",\n    "difference": 1.7968083865943187\n}\n'})})]})}function p(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},11151:(e,n,a)=>{a.d(n,{Z:()=>s,a:()=>r});var t=a(67294);const i={},o=t.createContext(i);function r(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);